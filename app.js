// Dados dos textos
const textData = {
  "textos": {
    "3ano": [
      "O computador ajuda a fazer tarefas.\n\nO computador é uma máquina muito útil. Ele nos ajuda em casa e na escola. Podemos usá-lo para escrever textos e fazer desenhos.\n\nO computador tem um teclado para digitar. Tem também um mouse para clicar nas coisas na tela. A tela mostra tudo o que fazemos.\n\nCom o computador, podemos aprender coisas novas. Ele é nosso amigo na hora de estudar. Devemos cuidar bem dele para que dure muito tempo.",
      "O celular conecta pessoas.\n\nO celular é um aparelho pequeno e útil. Ele cabe na nossa mão e podemos levá-lo para todos os lugares. Com ele, falamos com pessoas que estão longe.\n\nO celular tem números para discar. Também tem uma tela que mostra fotos e mensagens. Podemos tirar fotos dos nossos amigos e família.\n\nÉ importante usar o celular com cuidado. Devemos pedir ajuda aos adultos quando precisamos. O celular nos ajuda a ficar perto de quem amamos.",
      "Os jogos no tablet são divertidos.\n\nO tablet é como um computador pequeno. Ele tem uma tela que podemos tocar com os dedos. Existem muitos jogos legais para jogar nele.\n\nOs jogos do tablet podem ensinar coisas importantes. Alguns jogos ajudam a aprender números e letras. Outros ensinam sobre animais e cores.\n\nDevemos jogar por pouco tempo no tablet. É bom brincar de outras coisas também. Podemos jogar bola, ler livros e conversar com os amigos.",
      "A internet tem muitas informações.\n\nA internet é como uma biblioteca gigante. Ela fica dentro do computador e do celular. Lá encontramos informações sobre tudo.\n\nNa internet, podemos ver vídeos engraçados. Também podemos pesquisar sobre animais e plantas. É um lugar cheio de conhecimento.\n\nDevemos usar a internet com um adulto por perto. Eles nos ajudam a encontrar coisas boas e seguras. A internet é legal quando usada direito.",
      "As câmeras guardam momentos especiais.\n\nAs câmeras servem para tirar fotos. Elas capturam momentos importantes da nossa vida. Podemos fotografar aniversários, passeios e brincadeiras.\n\nAs fotos ficam guardadas no computador ou celular. Assim, nunca esquecemos dos momentos felizes. Podemos mostrar as fotos para os amigos.\n\nÉ divertido tirar fotos da família e dos pets. As câmeras nos ajudam a lembrar de coisas boas. Cada foto conta uma história especial."
    ],
    "4ano": [
      "A internet conecta pessoas do mundo todo.\n\nA internet é uma rede mundial que conecta computadores e pessoas. Através dela, podemos conversar com amigos que moram em outros países. É incrível como a tecnologia aproxima as pessoas.\n\nCom a internet, enviamos mensagens instantâneas. Também podemos fazer videochamadas e ver o rosto de quem está longe. As redes sociais permitem compartilhar fotos e novidades com os amigos.\n\nA internet também serve para estudar e pesquisar. Encontramos informações sobre qualquer assunto em poucos segundos. Porém, devemos sempre verificar se as informações são verdadeiras. É importante navegar com segurança e responsabilidade.",
      "Os aplicativos facilitam nossa vida.\n\nOs aplicativos são programas especiais para celulares e tablets. Eles foram criados para tornar nossa vida mais fácil e divertida. Existem aplicativos para quase tudo que precisamos.\n\nAlguns aplicativos nos ajudam a estudar matemática e português. Outros servem para desenhar e criar música. Há também aplicativos que mostram o tempo e as notícias do dia.\n\nPara baixar aplicativos, precisamos da ajuda de um adulto. Eles sabem quais são seguros e adequados para nossa idade. Os melhores aplicativos educativos tornam o aprendizado mais interessante e divertido.",
      "Os videogames desenvolvem habilidades.\n\nOs videogames são mais do que simples diversão. Eles podem desenvolver várias habilidades importantes. Alguns jogos melhoram nosso raciocínio e nossa capacidade de resolver problemas.\n\nNos videogames, precisamos tomar decisões rápidas. Também desenvolvemos coordenação entre os olhos e as mãos. Muitos jogos ensinam sobre história, geografia e ciências de forma divertida.\n\nÉ importante jogar com moderação e escolher jogos educativos. Os pais podem nos ajudar a encontrar jogos adequados para nossa idade. Assim, nos divertimos e aprendemos ao mesmo tempo.",
      "A tecnologia nos ajuda a aprender.\n\nA tecnologia transformou a forma como estudamos e aprendemos. Computadores, tablets e lousas digitais tornaram as aulas mais interessantes. Podemos ver vídeos, fazer pesquisas e criar apresentações.\n\nOs livros digitais permitem ler histórias interativas. Também existem programas que ajudam a praticar matemática e português. A tecnologia torna o aprendizado mais visual e dinâmico.\n\nProfessores usam a tecnologia para explicar matérias difíceis. Eles mostram planetas no espaço e animais de outros países. Com a tecnologia, podemos aprender sobre qualquer lugar do mundo sem sair da escola.",
      "As redes sociais conectam amigos.\n\nAs redes sociais são plataformas na internet onde pessoas se conectam. Elas permitem compartilhar fotos, vídeos e mensagens com amigos e família. É uma forma moderna de manter contato com quem gostamos.\n\nAtravés das redes sociais, podemos saber novidades dos nossos amigos. Vemos fotos de viagens, festas de aniversário e momentos especiais. Também podemos parabenizar pessoas em datas importantes.\n\nUsar redes sociais requer cuidado e supervisão dos pais. Devemos compartilhar apenas com pessoas conhecidas e nunca revelar informações pessoais. A segurança online é muito importante para todos."
    ],
    "5ano": [
      "Os smartphones facilitam a comunicação e o acesso à informação.\n\nOs smartphones revolucionaram a forma como nos comunicamos e acessamos informações. Estes dispositivos portáteis concentram múltiplas funcionalidades em um único aparelho. Permitem fazer ligações, enviar mensagens, navegar na internet e executar diversos aplicativos.\n\nA principal vantagem dos smartphones é a conectividade constante. Podemos nos comunicar instantaneamente com pessoas ao redor do mundo através de mensagens de texto, chamadas de voz ou videochamadas. Além disso, o acesso imediato à internet possibilita consultar informações, mapas e notícias em tempo real.\n\nOs smartphones também servem como ferramentas educacionais poderosas. Existem aplicativos específicos para cada matéria escolar, desde matemática até idiomas estrangeiros. Entretanto, é fundamental usar estes dispositivos de forma consciente e equilibrada, estabelecendo limites de tempo e priorizando atividades offline como exercícios físicos e interação social presencial.",
      "A inteligência artificial está presente em nosso cotidiano.\n\nA inteligência artificial, conhecida como IA, refere-se à capacidade das máquinas de simular processos de raciocínio humano. Esta tecnologia está cada vez mais presente em nosso dia a dia, mesmo que nem sempre percebamos sua presença. Assistentes virtuais, sistemas de recomendação e filtros de spam são exemplos comuns.\n\nOs assistentes virtuais como Alexa e Siri utilizam IA para compreender comandos de voz e fornecer respostas adequadas. Eles podem reproduzir música, responder perguntas, controlar dispositivos domésticos e auxiliar em tarefas cotidianas. Esta tecnologia aprende com cada interação, tornando-se mais eficiente ao longo do tempo.\n\nA IA também está presente em plataformas de streaming que recomendam filmes e músicas baseadas em nossos gostos pessoais. Sistemas de navegação GPS utilizam algoritmos inteligentes para calcular as melhores rotas. É importante compreender que a IA é uma ferramenta que deve ser desenvolvida e utilizada de forma ética e responsável.",
      "A computação em nuvem transforma o armazenamento de dados.\n\nA computação em nuvem representa uma revolução na forma como armazenamos e acessamos informações digitais. Este sistema permite guardar dados em servidores remotos conectados à internet, em vez de depender exclusivamente do armazenamento local em nossos dispositivos. Serviços como Google Drive, iCloud e Dropbox exemplificam esta tecnologia.\n\nAs principais vantagens da nuvem incluem a acessibilidade universal dos dados. Podemos acessar nossos arquivos de qualquer dispositivo conectado à internet, seja computador, tablet ou smartphone. Isso facilita o trabalho colaborativo e garante que não perdemos informações importantes mesmo se nosso dispositivo apresentar problemas.\n\nA nuvem também oferece backup automático de fotos, documentos e outros arquivos importantes. Empresas e escolas utilizam esta tecnologia para facilitar o compartilhamento de recursos educacionais. Contudo, é essencial compreender questões de privacidade e segurança digital ao utilizar serviços de armazenamento em nuvem.",
      "A realidade virtual cria experiências imersivas.\n\nA realidade virtual, conhecida como VR, é uma tecnologia que cria ambientes tridimensionais artificiais nos quais podemos interagir de forma imersiva. Através de óculos especiais e controles de movimento, experimentamos sensações como se estivéssemos realmente presentes em mundos virtuais. Esta tecnologia tem aplicações em entretenimento, educação e treinamento profissional.\n\nNa educação, a realidade virtual permite explorar lugares impossíveis de visitar pessoalmente. Podemos caminhar por museus distantes, explorar o fundo do oceano ou viajar pelo sistema solar. Esta experiência imersiva torna o aprendizado mais envolvente e memorável, especialmente em matérias como história, geografia e ciências.\n\nA VR também está sendo utilizada para treinamento médico, simulações de voo e terapias psicológicas. Games em realidade virtual oferecem experiências de entretenimento completamente novas. Embora seja uma tecnologia fascinante, é importante usar a realidade virtual com moderação e sempre sob supervisão adequada.",
      "A robótica avança e auxilia em diversas atividades humanas.\n\nA robótica representa a convergência entre engenharia mecânica, eletrônica e programação para criar máquinas capazes de executar tarefas de forma autônoma ou semi-autônoma. Os robôs estão presentes em fábricas, hospitais, exploração espacial e até mesmo em nossas casas. Esta tecnologia continua evoluindo rapidamente e transformando diversos setores da sociedade.\n\nNas indústrias, robôs executam tarefas repetitivas com precisão e eficiência superiores às capacidades humanas. Na medicina, robôs auxiliam em cirurgias delicadas e no cuidado de pacientes. Robôs aspiradores domésticos automatizam a limpeza, enquanto robôs educacionais ensinam programação e lógica para estudantes.\n\nA exploração espacial depende extensivamente de robôs para investigar planetas distantes onde humanos não podem ir. Mars rovers coletam amostras e transmitem dados valiosos sobre Marte. No futuro, a robótica promete revolucionar ainda mais nossas vidas, desde carros autônomos até assistentes pessoais robóticos. É fundamental estudar e compreender esta tecnologia para participar ativamente do mundo tecnológico do futuro."
    ]
  }
};

// Variáveis globais
let currentGrade = '';
let currentText = '';
let correctCount = 0;
let errorCount = 0;
let isTypingComplete = false;

// Elementos DOM
const initialScreen = document.getElementById('initial-screen');
const typingScreen = document.getElementById('typing-screen');
const gradeTitle = document.getElementById('grade-title');
const originalTextElement = document.getElementById('original-text');
const userInput = document.getElementById('user-input');
const correctCountElement = document.getElementById('correct-count');
const errorCountElement = document.getElementById('error-count');
const successModal = document.getElementById('success-modal');

// Função para selecionar o ano escolar
function selectGrade(grade) {
    currentGrade = grade;
    const gradeNames = {
        '3ano': '3º Ano',
        '4ano': '4º Ano',
        '5ano': '5º Ano'
    };
    
    gradeTitle.textContent = `Digitação - ${gradeNames[grade]}`;
    
    // Carregar um texto aleatório para o ano selecionado
    loadRandomText();
    
    // Trocar para a tela de digitação
    showTypingScreen();
}

// Função para carregar um texto aleatório
function loadRandomText() {
    const texts = textData.textos[currentGrade];
    const randomIndex = Math.floor(Math.random() * texts.length);
    currentText = texts[randomIndex];
    originalTextElement.textContent = currentText;
    
    // Resetar campos
    resetTyping();
}

// Função para resetar a digitação
function resetTyping() {
    userInput.value = '';
    correctCount = 0;
    errorCount = 0;
    isTypingComplete = false;
    updateStats();
    userInput.classList.remove('error');
}

// Função para atualizar estatísticas
function updateStats() {
    correctCountElement.textContent = correctCount;
    errorCountElement.textContent = errorCount;
}

// Função para mostrar a tela de digitação
function showTypingScreen() {
    initialScreen.classList.remove('active');
    typingScreen.classList.add('active');
    
    // Focar no campo de digitação
    setTimeout(() => {
        userInput.focus();
    }, 100);
}

// Função para voltar à tela inicial
function goBackToInitial() {
    typingScreen.classList.remove('active');
    initialScreen.classList.add('active');
    successModal.classList.remove('active');
    currentGrade = '';
    currentText = '';
}

// Função para tentar novamente
function tryAgain() {
    resetTyping();
    userInput.focus();
}

// Função para trocar o texto
function changeText() {
    loadRandomText();
    successModal.classList.remove('active');
    userInput.focus();
}

// Função para comparar textos em tempo real
function compareTexts() {
    const userText = userInput.value;
    const originalText = currentText;
    
    let hasError = false;
    let correctChars = 0;
    
    // Comparar caractere por caractere
    for (let i = 0; i < userText.length; i++) {
        if (i >= originalText.length || userText[i] !== originalText[i]) {
            hasError = true;
            break;
        }
        correctChars++;
    }
    
    // Aplicar estilo baseado na comparação
    if (hasError) {
        userInput.classList.add('error');
    } else {
        userInput.classList.remove('error');
        
        // Verificar se completou o texto
        if (userText.length === originalText.length && userText === originalText) {
            if (!isTypingComplete) {
                isTypingComplete = true;
                correctCount = countWords(originalText);
                updateStats();
                showSuccessModal();
            }
        }
    }
    
    // Atualizar contadores
    if (!isTypingComplete) {
        const words = userText.trim().split(/\s+/).filter(word => word.length > 0);
        let correctWords = 0;
        let errors = 0;
        
        const originalWords = originalText.trim().split(/\s+/);
        
        for (let i = 0; i < words.length; i++) {
            if (i < originalWords.length) {
                // Verificar se a palavra está sendo digitada corretamente até agora
                const userWord = words[i];
                const originalWord = originalWords[i];
                
                if (userWord === originalWord) {
                    correctWords++;
                } else if (userWord.length >= originalWord.length || 
                          !originalWord.startsWith(userWord)) {
                    errors++;
                }
            }
        }
        
        correctCount = correctWords;
        errorCount = errors;
        updateStats();
    }
}

// Função para contar palavras
function countWords(text) {
    return text.trim().split(/\s+/).filter(word => word.length > 0).length;
}

// Função para mostrar modal de sucesso
function showSuccessModal() {
    document.getElementById('final-correct').textContent = correctCount;
    document.getElementById('final-errors').textContent = errorCount;
    successModal.classList.add('active');
}

// Event listeners
document.addEventListener('DOMContentLoaded', function() {
    // Prevenir copy/paste no campo de digitação
    userInput.addEventListener('paste', function(e) {
        e.preventDefault();
        return false;
    });
    
    // Prevenir copy
    userInput.addEventListener('copy', function(e) {
        e.preventDefault();
        return false;
    });
    
    // Prevenir cut
    userInput.addEventListener('cut', function(e) {
        e.preventDefault();
        return false;
    });
    
    // Prevenir drag and drop
    userInput.addEventListener('drop', function(e) {
        e.preventDefault();
        return false;
    });
    
    // Comparação em tempo real
    userInput.addEventListener('input', compareTexts);
    
    // Prevenir teclas de atalho para copiar/colar
    userInput.addEventListener('keydown', function(e) {
        // Prevenir Ctrl+A, Ctrl+C, Ctrl+V, Ctrl+X
        if (e.ctrlKey && (e.key === 'a' || e.key === 'c' || e.key === 'v' || e.key === 'x')) {
            e.preventDefault();
            return false;
        }
        
        // Prevenir Ctrl+Z (desfazer)
        if (e.ctrlKey && e.key === 'z') {
            e.preventDefault();
            return false;
        }
    });
    
    // Fechar modal ao clicar fora
    successModal.addEventListener('click', function(e) {
        if (e.target === successModal) {
            successModal.classList.remove('active');
        }
    });
});

// Prevenir menu de contexto (botão direito)
document.addEventListener('contextmenu', function(e) {
    if (e.target === userInput) {
        e.preventDefault();
    }
});

// Prevenir seleção de texto no campo original
originalTextElement.addEventListener('selectstart', function(e) {
    e.preventDefault();
});